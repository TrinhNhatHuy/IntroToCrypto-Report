\section{System Architecture}

The RSA digital signature system follows a linear pipeline divided into four stages. Figure~\ref{fig:flowchart} illustrates the complete signing and verification workflow.

\begin{figure}[H]
    \centering
    \begin{tikzpicture}[
            node distance=0.65cm,
            box/.style={rectangle, draw, rounded corners=3pt, minimum width=3.8cm, minimum height=0.7cm, align=center, font=\small},
            key/.style={rectangle, draw, rounded corners=3pt, minimum width=2.2cm, minimum height=0.6cm, align=center, font=\small},
            arrow/.style={-Stealth, thick}
        ]

        % Stage 1: Key Generation
        \node[box, fill=blue!12] (primes) {Input primes $p$, $q$};
        \node[box, fill=blue!12, below=of primes] (keygen) {Key Generation: $n,\;\phi(n),\;e,\;d$};
        \draw[arrow] (primes) -- (keygen);

        % Stage 2: Hashing
        \node[box, fill=orange!12, below=1.0cm of keygen] (msg) {Message $m$};
        \node[box, fill=orange!12, below=of msg] (hash) {Hash: $H = \texttt{hash}(m)$};
        \draw[arrow] (msg) -- (hash);

        % Stage 3: Signing
        \node[box, fill=orange!15, below=of hash] (sign) {Sign: $S = H^d \bmod n$};
        \node[key, fill=red!12, left=1.2cm of sign] (privkey) {Private Key\\$(d, n)$};
        \draw[arrow] (hash) -- (sign);
        \draw[arrow, color=red!60!black] (privkey) -- (sign);

        % Stage 4: Verification
        \node[box, fill=cyan!12, below=0.8cm of sign] (recover) {Recover: $H'' = S^e \bmod n$};
        \node[key, fill=green!12, right=1.2cm of recover] (pubkey) {Public Key\\$(e, n)$};
        \node[box, fill=cyan!12, below=of recover] (rehash) {Recompute: $H' = \texttt{hash}(m)$};
        \node[box, fill=yellow!20, below=of rehash] (compare) {Compare $H' \stackrel{?}{=} H''$};
        \draw[arrow] (sign) -- (recover);
        \draw[arrow, color=green!50!black] (pubkey) -- (recover);
        \draw[arrow] (recover) -- (rehash);
        \draw[arrow] (rehash) -- (compare);

        % Dashed lines from Key Generation to both keys
        \draw[arrow, dashed] (keygen.west) -| (privkey.north);
        \draw[arrow, dashed] (keygen.east) -| (pubkey.north);

        % Result â€” two colors matching the diagram
        \node[below=0.25cm of compare] {%
            \textbf{\color{green!60!black}Valid} \;/\; \textbf{\color{red!70!black}Invalid}%
        };

    \end{tikzpicture}
    \caption{RSA Digital Signature Pipeline}
    \label{fig:flowchart}
\end{figure}

\textbf{Module mapping to code:}

\begin{table}[H]
    \centering
    \renewcommand{\arraystretch}{1.3}
    \begin{tabular}{|p{3.2cm}|p{4.2cm}|p{5.5cm}|}
        \hline
        \textbf{Stage} & \textbf{Function}                            & \textbf{Operation}                   \\
        \hline
        Key Generation & \texttt{generate\_keypair(p, q)}             & Computes $n$, $\phi(n)$, $e$, $d$    \\
        \hline
        Hashing        & \texttt{hash\_with\_all(msg)}                & MD5, SHA-1, SHA-256, SHA-512         \\
        \hline
        Signing        & \texttt{sign\_all(msg, priv, hashes)}        & $S = H^d \bmod n$ for each algorithm \\
        \hline
        Verification   & \texttt{verify\_all(msg, sigs, pub, hashes)} & $H'' = S^e \bmod n$, compare to $H'$ \\
        \hline
    \end{tabular}
    \caption{Mapping between system stages and Python functions.}
    \label{tab:module_map}
\end{table}
